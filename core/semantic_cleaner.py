from llm.ollama_client import ask_llm

_clean_cache = {}

EXAMPLES = """
Фраза: "Джарвис, помоги мне пожалуйста, открой мне папку с названием Game"
Ответ: "открой папку Game"

Фраза: "Джарвис, запусти браузер срочно пожалуйста"
Ответ: "запусти браузер"

Фраза: "Открой сайт ютуб плиз"
Ответ: "открой сайт ютуб"

Фраза: "Привет Джарвис, будь добр, удали папку temp"
Ответ: "удали папку temp"

Фраза: "Сделай скриншот экрана"
Ответ: "сделай скриншот экрана"
"""

def semantic_clean_via_llm(user_text: str) -> str:
    if user_text in _clean_cache:
        return _clean_cache[user_text]

    prompt = f"""
Ты лучший в мире клинер пользовательских команд. 
Твоя задача — убрать из фразы лишние слова, обращения, вежливые обороты, эмоции, смайлики. 
Верни короткую суть команды для исполнения. Отвечай строго одной строкой без лишних символов и без комментариев.

Вот примеры:
{EXAMPLES}

Фраза: "{user_text}"
Ответ:
"""

    response = ask_llm(prompt)
    result = response.strip().strip('"')
    _clean_cache[user_text] = result
    return result
